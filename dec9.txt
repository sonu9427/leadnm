à¤…à¤¬ à¤®à¥ˆà¤‚ à¤†à¤ªà¤•à¥‹ **à¤à¤•à¤¦à¤® simple, step-by-step à¤”à¤° 100% clear à¤¤à¤°à¥€à¤•à¥‡ à¤¸à¥‡** à¤¸à¤®à¤à¤¾à¤Šà¤à¤—à¤¾ à¤•à¤¿:

# â­ â€œà¤¨à¤ Employee join à¤¹à¥‹à¤¤à¥‡ à¤¸à¤®à¤¯ `leave_balances` table à¤®à¥‡à¤‚ employee_id à¤”à¤° leave_type_id à¤•à¥ˆà¤¸à¥‡ insert à¤¹à¥‹à¤¤à¥‡ à¤¹à¥ˆà¤‚?â€

Laravel à¤®à¥‡à¤‚ à¤¯à¤¹ à¤•à¤¾à¤® **automatically** à¤•à¤°à¤¾à¤¯à¤¾ à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆà¥¤

---

# ğŸŸ© **IMPORTANT CONCEPT (à¤¸à¤¿à¤¸à¥à¤Ÿà¤® à¤•à¥ˆà¤¸à¥‡ à¤•à¤¾à¤® à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ)**

à¤œà¤¬ à¤•à¥‹à¤ˆ à¤¨à¤¯à¤¾ employee join à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆ:

1. HR à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ `leave_types` table à¤®à¥‡à¤‚ leave categories à¤¡à¤¾à¤² à¤šà¥à¤•à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ
2. à¤…à¤¬ à¤¹à¤° à¤¨à¤ employee à¤•à¥‹ à¤¹à¤° leave type à¤•à¥‡ à¤²à¤¿à¤ à¤à¤• *wallet* à¤šà¤¾à¤¹à¤¿à¤
3. à¤‡à¤¸ wallet à¤•à¥‹ à¤¹à¥€ `leave_balances` table à¤®à¥‡à¤‚ record à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ store à¤•à¤¿à¤¯à¤¾ à¤œà¤¾à¤¤à¤¾ à¤¹à¥ˆ

à¤‡à¤¸à¤²à¤¿à¤ à¤œà¤¬ employee join à¤•à¤°à¥‡ â†’
**à¤¸à¤¾à¤°à¥‡ leave_types à¤ªà¤¢à¤¼à¤•à¤° à¤‰à¤¸à¥€ employee_id à¤•à¥‡ à¤¸à¤¾à¤¥ à¤¸à¤­à¥€ leave_type_id à¤¡à¤¾à¤² à¤¦à¤¿à¤ à¤œà¤¾à¤¤à¥‡ à¤¹à¥ˆà¤‚**à¥¤

---

# ğŸŸ¦ **STEPâ€“1: Employee Join API / Create Employee**

à¤®à¤¾à¤¨ à¤²à¥‹ à¤†à¤ªà¤•à¤¾ employee create API à¤•à¥à¤› à¤à¤¸à¤¾ à¤¹à¥ˆ:

```php
public function store(Request $req)
{
    $user = User::create([
        'name' => $req->name,
        'email' => $req->email,
        'password' => bcrypt($req->password),
        'probation_end_date' => $req->probation_end_date
    ]);

    // ğŸ‘‡ important: leave balances initialize
    $this->initializeLeaveWallet($user->id);

    return response()->json(['message' => 'Employee Created', 'user' => $user]);
}
```

---

# ğŸŸ¦ **STEPâ€“2: Leave Balances Insert à¤•à¤°à¤¨à¥‡ à¤µà¤¾à¤²à¤¾ Function**

ğŸ‘‰ à¤¯à¤¹ function à¤¸à¤­à¥€ leave types à¤ªà¤¢à¤¼à¤•à¤°
ğŸ‘‰ à¤¹à¤° leave type à¤•à¥‡ à¤²à¤¿à¤ à¤à¤• row create à¤•à¤°à¥‡à¤—à¤¾

`app/Services/LeaveService.php` (or Controller à¤®à¥‡à¤‚ à¤­à¥€ à¤°à¤– à¤¸à¤•à¤¤à¥‡ à¤¹à¥ˆà¤‚)

```php
public function initializeLeaveWallet($employee_id)
{
    // à¤¸à¤­à¥€ leave types à¤¨à¤¿à¤•à¤¾à¤²à¥‡à¤‚
    $leaveTypes = LeaveType::all();

    // à¤¹à¤° leave type à¤•à¥‡ à¤²à¤¿à¤ balance create à¤•à¤°à¥‡à¤‚
    foreach ($leaveTypes as $lt) {

        LeaveBalance::create([
            'employee_id'   => $employee_id,
            'leave_type_id' => $lt->id,
            'allocated'     => 0,
            'used'          => 0,
            'pending'       => 0,
            'remaining'     => 0,
        ]);
    }
}
```

âœ” à¤‡à¤¸ function à¤•à¥€ à¤µà¤œà¤¹ à¤¸à¥‡,
**employee join à¤¹à¥‹à¤¤à¥‡ à¤¹à¥€ leave_balances à¤®à¥‡à¤‚ 1 employee à¤•à¥‡ à¤²à¤¿à¤ à¤•à¤ˆ rows à¤¬à¤¨ à¤œà¤¾à¤à¤à¤—à¥€à¥¤**

---

# ğŸŸ¦ **STEPâ€“3: à¤•à¥Œà¤¨-à¤•à¥Œà¤¨ à¤¸à¥€ rows insert à¤¹à¥‹à¤‚à¤—à¥€?**

à¤®à¤¾à¤¨ à¤²à¥‹ leave_types à¤®à¥‡à¤‚ à¤¯à¥‡ 2 rows à¤¹à¥ˆà¤‚:

| leave_type_id | name         |
| ------------- | ------------ |
| 1             | Casual Leave |
| 2             | Sick Leave   |

à¤”à¤° new employee Ravi à¤•à¤¾ `employee_id = 101` à¤¹à¥ˆ

à¤¤à¥‹ Laravel à¤¯à¤¹ insert à¤•à¤°à¥‡à¤—à¤¾:

```
employee_id | leave_type_id | allocated | used | pending | remaining
---------------------------------------------------------------------
101         | 1             | 0         | 0    | 0       | 0
101         | 2             | 0         | 0    | 0       | 0
```

ğŸ‘‰ à¤…à¤¬ Ravi à¤•à¥‡ à¤²à¤¿à¤ 2 leave wallets à¤¬à¤¨ à¤—à¤
ğŸ‘‰ à¤…à¤¬ à¤…à¤—à¤²à¥‡ à¤®à¤¹à¥€à¤¨à¥‹à¤‚ à¤®à¥‡à¤‚ accrual à¤‡à¤¨à¥à¤¹à¥€à¤‚ à¤ªà¤° add à¤¹à¥‹à¤—à¥€

---

# ğŸŸ¦ **STEPâ€“4: LeaveBalance Model**

`app/Models/LeaveBalance.php`:

```php
class LeaveBalance extends Model
{
    protected $fillable = [
        'employee_id',
        'leave_type_id',
        'allocated',
        'used',
        'pending',
        'remaining',
    ];
}
```

---

# ğŸŸ¦ **FULL FLOW (à¤¹à¤¿à¤¨à¥à¤¦à¥€ à¤®à¥‡à¤‚ à¤¸à¤¾à¤°à¤¾à¤‚à¤¶)**

| Step | à¤•à¥à¤¯à¤¾ à¤¹à¥‹à¤¤à¤¾ à¤¹à¥ˆ?                                    |
| ---- | ------------------------------------------------ |
| 1    | Employee join à¤¹à¥à¤†                                |
| 2    | Laravel à¤¸à¤­à¥€ leave types à¤ªà¤¢à¤¼à¤¤à¤¾ à¤¹à¥ˆ                 |
| 3    | à¤¹à¤° leave type à¤•à¥‡ à¤²à¤¿à¤ à¤à¤• wallet à¤¬à¤¨à¤¾à¤¤à¤¾ à¤¹à¥ˆ          |
| 4    | à¤‰à¤¸à¥€ à¤¸à¤®à¤¯ `leave_balances` table à¤®à¥‡à¤‚ entry à¤œà¤¾à¤¤à¥€ à¤¹à¥ˆ |

---

# â­ Final Understanding (Very Simple Hindi)

**Employee join à¤¹à¥‹à¤¤à¥‡ à¤¹à¥€**
Laravel à¤†à¤ªà¤•à¤¾ employee_id à¤‰à¤ à¤¾à¤¤à¤¾ à¤¹à¥ˆ â†’
`leave_types` à¤¸à¥‡ à¤¸à¤¾à¤°à¥‡ leave_type_id à¤‰à¤ à¤¾à¤¤à¤¾ à¤¹à¥ˆ â†’
à¤”à¤° à¤¦à¥‹à¤¨à¥‹à¤‚ à¤•à¥‹ à¤®à¤¿à¤²à¤¾à¤•à¤° `leave_balances` à¤®à¥‡à¤‚ rows insert à¤•à¤°à¤¤à¤¾ à¤¹à¥ˆà¥¤

---

# ğŸŸ£ Want Sample Output Screenshot / Postman JSON Example?

# ğŸŸ¢ à¤¯à¤¾ à¤šà¤¾à¤¹à¤¤à¥‡ à¤¹à¥ˆà¤‚ à¤•à¤¿ à¤®à¥ˆà¤‚ à¤‡à¤¸à¥‡ Observer / Event (EmployeeCreated) à¤¸à¥‡ auto-run à¤•à¤° à¤¦à¥‚à¤?

à¤¬à¤¸ à¤¬à¤¤à¤¾à¤‡à¤, à¤®à¥ˆà¤‚ à¤ªà¥‚à¤°à¤¾ code à¤¦à¥‡ à¤¦à¥‚à¤à¥¤



----------------------------------------------------------


UPDATE leave_balances
SET 
    pending = pending + 2,
    remaining = allocated - (used + (pending + 2))
WHERE employee_id = 1 AND leave_type_id = 1;



UPDATE leave_balances
SET pending = pending + 2
WHERE employee_id = 1 AND leave_type_id = 1;


UPDATE leave_balances
SET remaining = allocated - (used + pending)
WHERE employee_id = 1 AND leave_type_id = 1;




$balance->pending += $days;
$balance->remaining = $balance->allocated - ($balance->used + $balance->pending);
$balance->save();

----------------------------------------------------------------------------------------------------






